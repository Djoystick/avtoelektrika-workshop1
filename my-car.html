<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üì± –ú–æ–µ –∞–≤—Ç–æ - –ú–∞—Å—Ç–µ—Ä—Å–∫–∞—è</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="header-content">
                <h1 class="logo">‚ö° –ú–∞—Å—Ç–µ—Ä—Å–∫–∞—è –ê–≤—Ç–æ—ç–ª–µ–∫—Ç—Ä–∏–∫–∞</h1>
                <nav class="main-nav">
                    <a href="/" class="nav-link">üè† –ì–ª–∞–≤–Ω–∞—è</a>
                    <a href="/vehicles.html" class="nav-link">üöó –ü–æ –º–∞—Ä–∫–∞–º</a>
                    <a href="/error-codes.html" class="nav-link">üíª –ü–æ –æ—à–∏–±–∫–∞–º</a>
                    <a href="/my-car.html" class="nav-link active">üì± –ú–æ–µ –∞–≤—Ç–æ</a>
                </nav>
            </div>
        </header>

        <h2>üì± –ú–æ–π –≥–∞—Ä–∞–∂</h2>
        
        <section class="add-car">
            <h3>–î–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ–º–æ–±–∏–ª—å</h3>
            <div class="form-group">
                <select id="brand-select">
                    <option>–í—ã–±–µ—Ä–∏—Ç–µ –º–∞—Ä–∫—É...</option>
                </select>
                <select id="model-select">
                    <option>–í—ã–±–µ—Ä–∏—Ç–µ –º–æ–¥–µ–ª—å...</option>
                </select>
                <input id="year-input" type="number" placeholder="–ì–æ–¥ –≤—ã–ø—É—Å–∫–∞" min="1950" max="2025">
                <input id="vin-input-mycar" type="text" placeholder="VIN (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)">
                <button class="btn btn-primary" onclick="addCar()">–î–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ</button>
            </div>
        </section>

        <section class="my-cars">
            <h3>–í–∞—à–∏ –∞–≤—Ç–æ–º–æ–±–∏–ª–∏</h3>
            <div id="cars-list" class="cars-list"></div>
        </section>

        <section class="recommended">
            <h3>üìö –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏</h3>
            <div id="recommended-articles" class="articles-grid"></div>
        </section>
    </div>

    <script src="utils.js"></script>
    <script src="db-manager.js"></script>
    <script>
        class MyCarManager {
            constructor() {
                this.storageKey = 'myCars';
                this.cars = this.loadCars();
            }
            
            loadCars() {
                const data = localStorage.getItem(this.storageKey);
                return data ? JSON.parse(data) : [];
            }
            
            saveCars() {
                localStorage.setItem(this.storageKey, JSON.stringify(this.cars));
            }
            
            addCar(brand, model, year, vin) {
                this.cars.push({
                    id: Date.now(),
                    brand, model, year, vin,
                    addedDate: new Date().toISOString()
                });
                this.saveCars();
            }
            
            removeCar(id) {
                this.cars = this.cars.filter(c => c.id !== id);
                this.saveCars();
            }
        }
        
        let db, myCarMgr;
        
        document.addEventListener('DOMContentLoaded', async () => {
            db = new DatabaseManager();
            await db.init();
            myCarMgr = new MyCarManager();
            
            // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–µ–ª–µ–∫—Ç–æ–≤
            const brands = db.vehicles.brands;
            const brandSelect = document.getElementById('brand-select');
            brandSelect.innerHTML += Object.entries(brands).map(([key, info]) =>
                `<option value="${key}">${info.name}</option>`
            ).join('');
            
            brandSelect.addEventListener('change', (e) => {
                const models = brands[e.target.value]?.models || [];
                document.getElementById('model-select').innerHTML = 
                    '<option>–í—ã–±–µ—Ä–∏—Ç–µ –º–æ–¥–µ–ª—å...</option>' +
                    models.map(m => `<option value="${m}">${m}</option>`).join('');
            });
            
            // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –º–∞—à–∏–Ω
            function renderCars() {
                document.getElementById('cars-list').innerHTML = myCarMgr.cars.length === 0
                    ? '<p>–ê–≤—Ç–æ–º–æ–±–∏–ª–∏ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã</p>'
                    : myCarMgr.cars.map(car => `
                        <div class="car-card">
                            <h4>${car.brand} ${car.model} (${car.year})</h4>
                            ${car.vin ? `<p>VIN: ${car.vin}</p>` : ''}
                            <button onclick="removeCar(${car.id})" class="btn btn-danger">–£–¥–∞–ª–∏—Ç—å</button>
                        </div>
                    `).join('');
            }
            
            renderCars();
            window.addCar = () => {
                myCarMgr.addCar(
                    document.getElementById('brand-select').value,
                    document.getElementById('model-select').value,
                    document.getElementById('year-input').value,
                    document.getElementById('vin-input-mycar').value
                );
                renderCars();
            };
            
            window.removeCar = (id) => {
                myCarMgr.removeCar(id);
                renderCars();
            };
        });
    </script>
</body>
</html>
