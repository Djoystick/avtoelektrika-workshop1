<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–æ–µ –∞–≤—Ç–æ - –ü–æ–º–æ—â–Ω–∏–∫ –∞–≤—Ç–æ—ç–ª–µ–∫—Ç—Ä–∏–∫–∞</title>
    <link rel="stylesheet" href="./styles.css">
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="header-content">
                <div class="logo-wrapper">
                    <img src="./logo.png" alt="–ü–æ–º–æ—â–Ω–∏–∫ –∞–≤—Ç–æ—ç–ª–µ–∫—Ç—Ä–∏–∫–∞" class="logo-image">
                    <div class="logo-text">
                        <div class="logo-title">–ü–æ–º–æ—â–Ω–∏–∫ –∞–≤—Ç–æ—ç–ª–µ–∫—Ç—Ä–∏–∫–∞</div>
                        <div class="logo-subtitle">–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è –±–∞–∑–∞ –∑–Ω–∞–Ω–∏–π –ø–æ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–µ –∏ —Ä–µ–º–æ–Ω—Ç—É</div>
                    </div>
                </div>
                <nav class="main-nav">
                    <a href="./" class="nav-link">üè† –ì–ª–∞–≤–Ω–∞—è</a>
                    <a href="./vehicles.html" class="nav-link">üöó –ü–æ –º–∞—Ä–∫–∞–º</a>
                    <a href="./error-codes.html" class="nav-link">üíª –ü–æ –æ—à–∏–±–∫–∞–º</a>
                    <a href="./my-car.html" class="nav-link active">üì± –ú–æ–µ –∞–≤—Ç–æ</a>
                </nav>
            </div>
        </header>

        <section class="page-content">
            <h2>üì± –ú–æ–µ –∞–≤—Ç–æ</h2>
            
            <div class="my-car-setup">
                <div class="form-group">
                    <label>üöô –ú–∞—Ä–∫–∞ –∞–≤—Ç–æ:</label>
                    <input id="my-brand" type="text" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, LADA, Toyota, BMW" class="form-input">
                </div>
                
                <div class="form-group">
                    <label>üèéÔ∏è –ú–æ–¥–µ–ª—å:</label>
                    <input id="my-model" type="text" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, Granta, Camry" class="form-input">
                </div>
                
                <div class="form-group">
                    <label>üìÖ –ì–æ–¥ –≤—ã–ø—É—Å–∫–∞:</label>
                    <input id="my-year" type="number" placeholder="2020" min="1990" max="2030" class="form-input">
                </div>
                
                <button onclick="saveMycar()" class="btn btn-primary">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                <button onclick="clearMycar()" class="btn btn-secondary">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å</button>
            </div>

            <div id="my-car-info" class="hidden" style="margin: 30px 0; padding: 20px; background: #f5f5f5; border-radius: 8px;">
                <h3>üì± –í–∞—à–µ –∞–≤—Ç–æ: <span id="car-display"></span></h3>
            </div>

            <div id="my-car-articles" class="articles-grid"></div>
        </section>
    </div>

    <footer class="footer">
        <p>–û–±–Ω–æ–≤–ª–µ–Ω–æ: <span id="last-update">–∑–∞–≥—Ä—É–∑–∫–∞...</span></p>
        <p>ü§ñ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç</p>
    </footer>

    <script src="./utils.js"></script>
    <script src="./db-manager.js"></script>
    <script>
        let db;
        
        document.addEventListener('DOMContentLoaded', async () => {
            db = new DatabaseManager();
            await db.init();
            
            document.getElementById('last-update').textContent = 
                new Date(db.db.lastUpdated).toLocaleString('ru-RU');
            
            loadMycar();
        });
        
        function saveMycar() {
            const brand = document.getElementById('my-brand').value.trim();
            const model = document.getElementById('my-model').value.trim();
            const year = document.getElementById('my-year').value.trim();
            
            if (!brand) {
                alert('‚ö†Ô∏è –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –º–∞—Ä–∫—É –∞–≤—Ç–æ');
                return;
            }
            
            const carData = { brand, model, year };
            localStorage.setItem('mycar', JSON.stringify(carData));
            
            alert('‚úÖ –ú–∞—à–∏–Ω–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞!');
            loadMycar();
        }
        
        function clearMycar() {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã? –≠—Ç–æ —É–¥–∞–ª–∏—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.')) {
                localStorage.removeItem('mycar');
                document.getElementById('my-brand').value = '';
                document.getElementById('my-model').value = '';
                document.getElementById('my-year').value = '';
                document.getElementById('my-car-info').classList.add('hidden');
                document.getElementById('my-car-articles').innerHTML = '';
                alert('‚úÖ –î–∞–Ω–Ω—ã–µ –æ—á–∏—â–µ–Ω—ã');
            }
        }
        
        function loadMycar() {
            const stored = localStorage.getItem('mycar');
            
            if (stored) {
                try {
                    const car = JSON.parse(stored);
                    document.getElementById('my-brand').value = car.brand || '';
                    document.getElementById('my-model').value = car.model || '';
                    document.getElementById('my-year').value = car.year || '';
                    
                    const carDisplay = `${car.brand}${car.model ? ' ' + car.model : ''}${car.year ? ' (' + car.year + ')' : ''}`;
                    document.getElementById('car-display').textContent = carDisplay;
                    document.getElementById('my-car-info').classList.remove('hidden');
                    
                    const articles = db.searchByBrand(car.brand);
                    
                    if (articles.length === 0) {
                        document.getElementById('my-car-articles').innerHTML = 
                            `<p style="grid-column: 1/-1; text-align: center;">–†–µ—à–µ–Ω–∏–π –¥–ª—è ${car.brand} –ø–æ–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</p>`;
                        return;
                    }
                    
                    document.getElementById('my-car-articles').innerHTML = articles.map(a => `
                        <div class="article-card">
                            ${a.image ? `<img src="${a.image}" alt="">` : ''}
                            <h4>${a.title}</h4>
                            <p class="meta">${a.contentType} ‚Ä¢ ${a.source}</p>
                            <p>${a.summary.substring(0, 150)}...</p>
                            <a href="${a.link}" target="_blank" class="btn-read">–ß–∏—Ç–∞—Ç—å</a>
                        </div>
                    `).join('');
                } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', e);
                    document.getElementById('my-car-articles').innerHTML = '<p>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö</p>';
                }
            } else {
                document.getElementById('my-car-info').classList.add('hidden');
                document.getElementById('my-car-articles').innerHTML = 
                    '<p style="grid-column: 1/-1; text-align: center;">üëÜ –í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –≤–∞—à–µ–≥–æ –∞–≤—Ç–æ –≤—ã—à–µ</p>';
            }
        }
    </script>
</body>
</html>
