<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–æ –º–∞—Ä–∫–∞–º - –ú–∞—Å—Ç–µ—Ä—Å–∫–∞—è –ê–≤—Ç–æ—ç–ª–µ–∫—Ç—Ä–∏–∫–∞</title>
    <link rel="stylesheet" href="./styles.css">
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="header-content">
                <h1 class="logo">‚ö° –ú–∞—Å—Ç–µ—Ä—Å–∫–∞—è –ê–≤—Ç–æ—ç–ª–µ–∫—Ç—Ä–∏–∫–∞</h1>
                <p class="tagline">–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è –±–∞–∑–∞ –∑–Ω–∞–Ω–∏–π –ø–æ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–µ –∏ —Ä–µ–º–æ–Ω—Ç—É</p>
                <nav class="main-nav">
                    <a href="./" class="nav-link">üè† –ì–ª–∞–≤–Ω–∞—è</a>
                    <a href="./vehicles.html" class="nav-link active">üöó –ü–æ –º–∞—Ä–∫–∞–º</a>
                    <a href="./error-codes.html" class="nav-link">üíª –ü–æ –æ—à–∏–±–∫–∞–º</a>
                    <a href="./my-car.html" class="nav-link">üì± –ú–æ–µ –∞–≤—Ç–æ</a>
                </nav>
            </div>
        </header>

        <section class="page-content">
            <h2>üöó –†–µ—à–µ–Ω–∏—è –ø–æ –º–∞—Ä–∫–∞–º –∞–≤—Ç–æ</h2>
            <div id="brands-list" class="brands-grid"></div>
            <div id="filtered-articles" class="articles-grid hidden"></div>
        </section>
    </div>

    <footer class="footer">
        <p>–û–±–Ω–æ–≤–ª–µ–Ω–æ: <span id="last-update">–∑–∞–≥—Ä—É–∑–∫–∞...</span></p>
        <p>ü§ñ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç</p>
    </footer>

    <script src="./utils.js"></script>
    <script src="./db-manager.js"></script>
    <script>
        let db;
        
        document.addEventListener('DOMContentLoaded', async () => {
            db = new DatabaseManager();
            await db.init();
            
            document.getElementById('last-update').textContent = 
                new Date(db.db.lastUpdated).toLocaleString('ru-RU');
            
            const brands = db._getUniqueBrands();
            const brandsList = document.getElementById('brands-list');
            
            if (brands.length === 0) {
                brandsList.innerHTML = '<p>–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –º–∞—Ä–æ–∫ –∞–≤—Ç–æ</p>';
                return;
            }
            
            brandsList.innerHTML = brands.map(brand => `
                <div class="brand-card">
                    <h3>üöô ${brand}</h3>
                    <p>${db.searchByBrand(brand).length} —Ä–µ—à–µ–Ω–∏–π</p>
                    <button onclick="filterByBrand('${brand}')" class="btn btn-primary">–ü–æ–∫–∞–∑–∞—Ç—å</button>
                </div>
            `).join('');
        });
        
        function filterByBrand(brand) {
            const articles = db.searchByBrand(brand);
            const brandsList = document.getElementById('brands-list');
            const filteredArticles = document.getElementById('filtered-articles');
            
            if (articles.length === 0) {
                alert('–†–µ—à–µ–Ω–∏–π –Ω–µ –Ω–∞–π–¥–µ–Ω–æ');
                return;
            }
            
            brandsList.classList.add('hidden');
            filteredArticles.classList.remove('hidden');
            
            filteredArticles.innerHTML = `
                <div style="margin-bottom: 20px;">
                    <button onclick="goBack()" class="btn btn-secondary">‚Üê –ù–∞–∑–∞–¥ –∫ –º–∞—Ä–∫–∞–º</button>
                    <h3>üöó –†–µ—à–µ–Ω–∏—è –¥–ª—è ${brand}</h3>
                </div>
                ${articles.map(a => `
                    <div class="article-card">
                        ${a.image ? `<img src="${a.image}" alt="">` : ''}
                        <h4>${a.title}</h4>
                        <p class="meta">${a.contentType} ‚Ä¢ ${a.source}</p>
                        <p>${a.summary.substring(0, 150)}...</p>
                        <a href="${a.link}" target="_blank" class="btn-read">–ß–∏—Ç–∞—Ç—å</a>
                    </div>
                `).join('')}
            `;
        }
        
        function goBack() {
            document.getElementById('brands-list').classList.remove('hidden');
            document.getElementById('filtered-articles').classList.add('hidden');
        }
    </script>
</body>
</html>