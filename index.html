<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîß –ü–æ–º–æ—â–Ω–∏–∫ –∞–≤—Ç–æ—ç–ª–µ–∫—Ç—Ä–∏–∫–∞ - –ë–∞–∑–∞ —Ä–µ—à–µ–Ω–∏–π</title>
    <link rel="stylesheet" href="./styles.css">
</head>
<body>
    <div class="container">
        <!-- –ù–ê–í–ò–ì–ê–¶–ò–Ø -->
        <header class="header">
            <div class="header-content">
                <div class="logo-wrapper">
                    <img src="./logo.png" alt="–ü–æ–º–æ—â–Ω–∏–∫ –∞–≤—Ç–æ—ç–ª–µ–∫—Ç—Ä–∏–∫–∞" class="logo-image">
                    <div class="logo-text">
                        <div class="logo-title">–ü–æ–º–æ—â–Ω–∏–∫ –∞–≤—Ç–æ—ç–ª–µ–∫—Ç—Ä–∏–∫–∞</div>
                        <div class="logo-subtitle">–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è –±–∞–∑–∞ –∑–Ω–∞–Ω–∏–π –ø–æ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–µ –∏ —Ä–µ–º–æ–Ω—Ç—É</div>
                    </div>
                </div>
                <nav class="main-nav">
                    <a href="./" class="nav-link active">üè† –ì–ª–∞–≤–Ω–∞—è</a>
                    <a href="./vehicles.html" class="nav-link">üöó –ü–æ –º–∞—Ä–∫–∞–º</a>
                    <a href="./error-codes.html" class="nav-link">üíª –ü–æ –æ—à–∏–±–∫–∞–º</a>
                    <a href="./my-car.html" class="nav-link">üì± –ú–æ–µ –∞–≤—Ç–æ</a>
                </nav>
            </div>
        </header>

        <!-- VIN-–î–ï–ö–û–î–ï–† -->
        <section class="vin-decoder">
            <h2>üîç –†–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞ VIN</h2>
            <div class="vin-input-group">
                <input id="vin-input" type="text" placeholder="–í–≤–µ–¥–∏—Ç–µ VIN (17 —Å–∏–º–≤–æ–ª–æ–≤)" maxlength="17" class="vin-input">
                <button id="decode-btn" class="btn btn-primary">–î–µ–∫–æ–¥–∏—Ä–æ–≤–∞—Ç—å</button>
            </div>
            <div id="vin-result" class="vin-result hidden"></div>
        </section>

        <!-- DTC –ü–û–ò–°–ö -->
        <section class="dtc-search">
            <h2>üö® –ü–æ–∏—Å–∫ –ø–æ –∫–æ–¥—É –æ—à–∏–±–∫–∏</h2>
            <div class="dtc-input-group">
                <input id="dtc-input" type="text" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ (P0300, C0040 –∏ —Ç.–¥.)" class="dtc-input">
                <button id="dtc-search-btn" class="btn btn-primary">–ù–∞–π—Ç–∏</button>
            </div>
            <div id="dtc-result" class="dtc-result hidden"></div>
        </section>

        <!-- –ü–û–ò–°–ö –ü–û –°–ò–ú–ü–¢–û–ú–£ -->
        <section class="symptom-search">
            <h2>üÜò –ò—â—É —Ä–µ—à–µ–Ω–∏–µ –ø–æ —Å–∏–º–ø—Ç–æ–º—É</h2>
            <div class="symptoms-grid">
                <button class="symptom-btn" data-symptom="–Ω–µ –∑–∞–≤–æ–¥–∏—Ç—Å—è">üÜò –ù–µ –∑–∞–≤–æ–¥–∏—Ç—Å—è</button>
                <button class="symptom-btn" data-symptom="–≥–æ—Ä–∏—Ç —á–µ–∫">üí° –ì–æ—Ä–∏—Ç Check Engine</button>
                <button class="symptom-btn" data-symptom="—Ç—Ä–æ–∏—Ç">üí® –¢—Ä–æ–∏—Ç –¥–≤–∏–≥–∞—Ç–µ–ª—å</button>
                <button class="symptom-btn" data-symptom="–Ω–µ—Ç –∑–∞—Ä—è–¥–∫–∏">üîã –ù–µ—Ç –∑–∞—Ä—è–¥–∫–∏</button>
                <button class="symptom-btn" data-symptom="—É—Ç–µ—á–∫–∞ —Ç–æ–∫–∞">‚ö° –£—Ç–µ—á–∫–∞ —Ç–æ–∫–∞</button>
                <button class="symptom-btn" data-symptom="—Å—Ç—É—á–∏—Ç">üîä –°—Ç—É—á–∏—Ç</button>
            </div>
        </section>

        <!-- –°–¢–ê–¢–ò–°–¢–ò–ö–ê -->
        <section class="stats">
            <div class="stat-card">
                <div class="stat-number" id="stat-articles">0</div>
                <div class="stat-label">–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–π</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="stat-brands">0</div>
                <div class="stat-label">–ú–∞—Ä–æ–∫ –∞–≤—Ç–æ</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="stat-codes">0</div>
                <div class="stat-label">–ö–æ–¥–æ–≤ –æ—à–∏–±–æ–∫</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="stat-videos">0</div>
                <div class="stat-label">–í–∏–¥–µ–æ</div>
            </div>
        </section>

        <!-- –¢–û–ü –†–ï–®–ï–ù–ò–ô -->
        <section class="top-solutions">
            <h2>üèÜ –¢–æ–ø —Ä–µ—à–µ–Ω–∏–π</h2>
            <div id="top-articles" class="articles-grid"></div>
        </section>
    </div>

    <footer class="footer">
        <p>–û–±–Ω–æ–≤–ª–µ–Ω–æ: <span id="last-update">–∑–∞–≥—Ä—É–∑–∫–∞...</span></p>
        <p>ü§ñ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç</p>
    </footer>

    <script src="./utils.js"></script>
    <script src="./db-manager.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const db = new DatabaseManager();
            await db.init();
            
            // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
            const stats = db.getStats();
            document.getElementById('stat-articles').textContent = stats.totalArticles;
            document.getElementById('stat-brands').textContent = stats.totalBrands;
            document.getElementById('stat-codes').textContent = stats.totalErrorCodes;
            document.getElementById('stat-videos').textContent = 
                db.articles.filter(a => a.contentType === 'üé¨ –í–∏–¥–µ–æ').length;
            
            // –í—Ä–µ–º—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
            document.getElementById('last-update').textContent = 
                new Date(db.db.lastUpdated).toLocaleString('ru-RU');
            
            // VIN-–¥–µ–∫–æ–¥–µ—Ä (—É–ø—Ä–æ—â–µ–Ω–Ω—ã–π –ø—Ä–∏–º–µ—Ä)
            document.getElementById('decode-btn').addEventListener('click', async () => {
                const vinBtn = document.getElementById('decode-btn');
                const vinInput = document.getElementById('vin-input');
                const resultDiv = document.getElementById('vin-result');
                
                const vin = vinInput.value.trim().toUpperCase();
                
                if (!/^[A-HJ-NPR-Z0-9]{17}$/.test(vin)) {
                    alert('–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π VIN (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 17 —Å–∏–º–≤–æ–ª–æ–≤, –±–µ–∑ I, O, Q)');
                    return;
                }

                vinBtn.textContent = "‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞...";
                vinBtn.disabled = true;
                resultDiv.innerHTML = "";
                resultDiv.classList.add('hidden');

                try {
                    const decoded = {
                        brand: vin.substring(0, 3) === 'XTA' ? 'LADA' : vin.substring(0, 3),
                        model: 'Model',
                        year: 2000 + (parseInt(vin.substring(9, 10)) || 20),
                        body: 'Sedan',
                        engine: '1.6L',
                        fuel: 'Petrol',
                        manufacturer: 'Unknown'
                    };
                    
                    resultDiv.innerHTML = `
                        <div class="card vin-card">
                            <div class="vin-header">
                                <h4>üöó ${decoded.brand} ${decoded.model} (${decoded.year})</h4>
                            </div>
                            <div class="vin-details">
                                <p><strong>–ö—É–∑–æ–≤:</strong> ${decoded.body}</p>
                                <p><strong>–î–≤–∏–≥–∞—Ç–µ–ª—å:</strong> ${decoded.engine}</p>
                                <p><strong>–¢–æ–ø–ª–∏–≤–æ:</strong> ${decoded.fuel}</p>
                                <p><strong>–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å:</strong> ${decoded.manufacturer}</p>
                            </div>
                            <a href="./vehicles.html" class="btn btn-small">–ù–∞–π—Ç–∏ —Ä–µ—à–µ–Ω–∏—è –¥–ª—è —ç—Ç–æ–≥–æ –∞–≤—Ç–æ</a>
                        </div>
                    `;
                    resultDiv.classList.remove('hidden');
                } catch (e) {
                    alert("–û—à–∏–±–∫–∞ –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è: " + e.message);
                } finally {
                    vinBtn.textContent = "–î–µ–∫–æ–¥–∏—Ä–æ–≤–∞—Ç—å";
                    vinBtn.disabled = false;
                }
            });

            // DTC –ø–æ–∏—Å–∫
            document.getElementById('dtc-search-btn').addEventListener('click', () => {
                const code = document.getElementById('dtc-input').value.toUpperCase();
                const articles = db.searchByErrorCode(code);
                document.getElementById('dtc-result').innerHTML = `
                    <div class="card">
                        <h4>üíª –û—à–∏–±–∫–∞ ${code}</h4>
                        <p>–ù–∞–π–¥–µ–Ω–æ —Ä–µ—à–µ–Ω–∏–π: ${articles.length}</p>
                        ${articles.slice(0, 3).map(a => `
                            <div class="mini-card">
                                <h5>${a.title}</h5>
                                <p>${a.contentType} ‚Ä¢ ${a.source}</p>
                            </div>
                        `).join('')}
                    </div>
                `;
                document.getElementById('dtc-result').classList.remove('hidden');
            });
            
            // –ü–æ–∏—Å–∫ –ø–æ —Å–∏–º–ø—Ç–æ–º—É (–ø–æ–∫–∞ –ø—Ä–æ—Å—Ç–æ –ª–æ–≥ –≤ –∫–æ–Ω—Å–æ–ª—å)
            document.querySelectorAll('.symptom-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const symptom = btn.dataset.symptom;
                    const results = db.searchBySymptom(symptom);
                    console.log(`–ù–∞–π–¥–µ–Ω–æ –¥–ª—è "${symptom}": ${results.length} —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤`);
                });
            });
            
            // –¢–æ–ø —Ä–µ—à–µ–Ω–∏–π
            const topArticles = db.articles.slice(0, 6);
            document.getElementById('top-articles').innerHTML = topArticles.map(a => `
                <div class="article-card">
                    ${a.image ? `<img src="${a.image}" alt="">` : ''}
                    <h4>${a.title}</h4>
                    <p class="meta">${a.contentType} ‚Ä¢ ${a.source}</p>
                    <p>${a.summary.substring(0, 100)}...</p>
                    <a href="${a.link}" target="_blank" class="btn-read">–ß–∏—Ç–∞—Ç—å</a>
                </div>
            `).join('');
        });
    </script>
</body>
</html>
